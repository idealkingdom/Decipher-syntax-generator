<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<title>Decipher Tools!</title>
		<link rel="stylesheet" href="res/codemirror-5.40.0/addon/hint/show-hint.css">
		<link rel="stylesheet" type="text/css" href="res/Css/bootstrap.min.superhero.css">
		<link rel="stylesheet" type="text/css" href="res/Css/index.style.css">
		<link rel="stylesheet" type="text/css" href="res/codemirror-5.40.0/lib/codemirror.css">
		<link rel="stylesheet" href="res/codemirror-5.40.0/addon/dialog/dialog.css">
		<link rel="stylesheet" href="res/codemirror-5.40.0/theme/monokai.css">
		<script type="text/javascript" src="res/Js/jquery-3.3.1.js"></script>
		<script src="res/codemirror-5.40.0/lib/codemirror.js"></script>
		<script src="res/codemirror-5.40.0/mode/xml/xml.js"></script>
		<script src="res/codemirror-5.40.0/addon/fold/xml-fold.js"></script>
		<script src="res/codemirror-5.40.0/mode/htmlmixed/htmlmixed.js"></script>
		<script src="res/codemirror-5.40.0/addon/hint/modshow-hint.js"></script>
		<script src="res/codemirror-5.40.0/addon/hint/xml-hint.js"></script>
		<script src="res/codemirror-5.40.0/addon/hint/html-hint.js"></script>
		<script src="res/codemirror-5.40.0/addon/hint/javascript-hint.js"></script>
		<script src="res/codemirror-5.40.0/addon/edit/closetag.js"></script>
		<script src="res/codemirror-5.40.0/addon/edit/trailingspace.js"></script>
		<script src="res/codemirror-5.40.0/addon/edit/matchtags.js"></script>
		<script src="res/codemirror-5.40.0/addon/edit/closebrackets.js"></script>
		<script src="res/codemirror-5.40.0/addon/scroll/annotatescrollbar.js"></script>
		<script src="res/codemirror-5.40.0/addon/search/matchesonscrollbar.js"></script>
		<script src="res/codemirror-5.40.0/addon/dialog/dialog.js"></script>
		<script src="res/codemirror-5.40.0/addon/search/jump-to-line.js"></script>
		<script src="res/codemirror-5.40.0/addon/search/search.js"></script>
		<script src="res/codemirror-5.40.0/addon/search/match-highlighter.js"></script>
		<script src="res/codemirror-5.40.0/addon/search/searchcursor.js"></script>
	</head>
	<body>
		<nav class="navbar navbar-lg navbar-dark bg-dark navbar-fixed-top">
			<div class="navbar-collapse" id="navbarColor02">
				<ul class="navbar-nav">
					<div class="btn-group" role="group" style="margin-left: 2%;">
						<li class="nav-item dropdown">
							<a class="nav-link dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false">Row</a>
							<div class="dropdown-menu" x-placement="bottom-start" style="position: absolute; will-change: transform; top: 0px; left: 0px; transform: translate3d(0px, 40px, 0px);">
								<a class="dropdown-item" href="#" id="clean" onclick="elementType('row')">Clean</a>
								<a class="dropdown-item" href="#" onclick="elementType('rowV')">Clean w/ Value</a>
								<a class="dropdown-item" href="#" onclick="elementType('rowR')">Reverse label</a>
								<a class="dropdown-item" href="#" onclick="elementType('rowRV')">Reverse w/ Value</a>
								<a class="dropdown-item" href="#" onclick="elementType('rowMatchv')">Label Match Values</a>
							</div>
						</li>
						<li class="nav-item dropdown" style="margin-left: 4%">
							<a class="nav-link dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false">Column</a>
							<div class="dropdown-menu" x-placement="bottom-start" style="position: absolute; will-change: transform; top: 0px; left: 0px; transform: translate3d(0px, 40px, 0px);">
								<a class="dropdown-item" href="#" onclick="elementType('col')">Clean</a>
								<a class="dropdown-item" href="#" onclick="elementType('colV')">Clean w/ value</a>
								<a class="dropdown-item" href="#" onclick="elementType('colR')">Reverse label</a>
								<a class="dropdown-item" href="#" onclick="elementType('colRV')">Reverse w/ Value</a>
								<a class="dropdown-item" href="#" onclick="elementType('colMatchv')">Label Match Values</a>
							</div>
						</li>
						<li class="nav-item dropdown" style="margin-left: 4%">
							<a class="nav-link dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false">Choice</a>
							<div class="dropdown-menu" x-placement="bottom-start" style="position: absolute; will-change: transform; top: 0px; left: 0px; transform: translate3d(0px, 40px, 0px);">
								<a class="dropdown-item" href="#" onclick="elementType('choice')">Clean</a>
								<a class="dropdown-item" href="#" onclick="elementType('choiceC')">Clean w/ Value</a>
								<a class="dropdown-item" href="#" onclick="elementType('choiceR')">Reverse label</a>
								<a class="dropdown-item" href="#" onclick="elementType('choiceRV')">Reverse w/ Value</a>
								<a class="dropdown-item" href="#" onclick="elementType('choiceMatchv')">Label Match Values</a>
							</div>
						</li>
						<li class="nav-item dropdown" style="margin-left: 4%">
							<a class="nav-link dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false">Group</a>
							<div class="dropdown-menu" x-placement="bottom-start" style="position: absolute; will-change: transform; top: 0px; left: 0px; transform: translate3d(0px, 40px, 0px);">
								<a class="dropdown-item" href="#" onclick="elementType('group')">Clean</a>
								<a class="dropdown-item" href="#" onclick="elementType('groupV')">Clean w/ Value</a>
								<a class="dropdown-item" href="#" onclick="elementType('groupR')">Reverse label</a>
								<a class="dropdown-item" href="#" onclick="elementType('groupRV')">Reverse w/ Value</a>
								<a class="dropdown-item" href="#" onclick="elementType('groupMatchv')">Label Match Group</a>
							</div>
						</li>
						<li class="nav-item dropdown" style="margin-left: 4%">
							<a class="nav-link dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false">Loop/Block</a>
							<div class="dropdown-menu" x-placement="bottom-start" style="position: absolute; will-change: transform; top: 0px; left: 0px; transform: translate3d(0px, 40px, 0px);">
								<a class="dropdown-item" href="#" onclick="loopBlock('loop')">Loop</a>
								<a class="dropdown-item" href="#" onclick="loopBlock('block')">Block</a>
							</div>
						</li>
						<li class="nav-item dropdown" style="margin-left: 4%">
							<a class="nav-link dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false">Question Types</a>
							<div class="dropdown-menu" x-placement="bottom-start" style="position: absolute; will-change: transform; top: 0px; left: 0px; transform: translate3d(0px, 40px, 0px);">
								<a class="dropdown-item" href="#" onclick="questionType('radio')">Radio</a>
								<a class="dropdown-item" href="#" onclick="questionType('radioR')">Radio Rating</a>
								<a class="dropdown-item" href="#" onclick="questionType('checkbox')">Checkbox</a>
								<a class="dropdown-item" href="#" onclick="questionType('select')">Select</a>
								<a class="dropdown-item" href="#" onclick="questionType('number')">Number</a>
								<a class="dropdown-item" href="#" onclick="questionType('text')">Text</a>
								<a class="dropdown-item" href="#" onclick="questionType('textarea')">Textarea</a>
								<a class="dropdown-item" href="#" onclick="questionType('comment')">HTML tag/Comment</a>
							</div>
						</li>
						<li class="nav-item dropdown" style="margin-left: 10%">
							<a class="nav-link dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false">Open/Save text</a>
							<div class="dropdown-menu" x-placement="bottom-start" style="position: absolute; will-change: transform; top: 0px; left: 0px; transform: translate3d(0px, 40px, 0px);">
								<input id = "openFile" type="file" accept="text/plain,text/xml" class="btn btn-secondary openFile" onchange="openFile(event)" value="Open file" placeholder="" >
								<input id = "saveFile" type="button" class="btn btn-secondary saveFile" onclick="downloadText()" value="Save file" placeholder="" >
								<a download="survey.xml" id="downloadtext" style="display: none">Download</a>								
							</div>
						</li>
      	

<button type="button" style="margin-left: 10%;" class="btn btn-primary btn-sm" data-toggle="modal" data-target="#settingsmodal">Settings</button>
				</ul>
			</div>
		</nav>


		<div class="main-div jumbotron">
				<div class="column "><textarea id="dataText" name="dataText"></textarea></div>
			</div>
		</div>
	</div>
<!-- Modal -->

<div class="modal" id="settingsmodal">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Settings</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
  <div class="form-group">
    <div class="custom-control custom-checkbox">
      <input type="checkbox" class="custom-control-input" id="autocompletesett" checked="">
      <label class="custom-control-label" for="autocompletesett">Hint</label>
    </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary" data-dismiss="modal" onclick="settingsEnableAutocomplete(editor)">Close</button>
      </div>
    </div>
  </div>
</div>
</div>
<script type="text/javascript">
var hintlist = ["row","rows","block","loop","looprow","col","cols","group","groups","value","values","alt","adim","altlabel","averages","below","type","rating","order","rightOf","blankValue","choice","choiceCond","rowCond","colCond","choiceShuffle","rowShuffle","colShuffle","blankIfZero","blankValue","colLegend","colLegendRows","colShuffle","cond","comment","dataSource","dataRef","exec","grouping","horizontalPercentages","keepWith","label","rowShuffle","noTranslate","open","optional","pii","ratingDirection","rowGroups","rowLegend","shuffle","shuffleBy","sort","sortChoices","sortCols","sortRows","style","title","type","uses","virtual","hidden","where","checkbox","radio","text","textarea","number","pipe","Other","block","loop","loopvar","looprow","style","row","col","choice","case",
	"where","optional","atleast","atmost","rowCond","label","colCond","loopvars",
	"target","cond","uses","verify","amount","onLoad","name","wrap","with","rightOf","leftOf","topOf",
	"bottomOf","ss:preText","ss:postText","execute","check","checked"]



var filtered = $.unique(hintlist.sort()).sort()
console.log(filtered);

CodeMirror.registerHelper('hint', 'dictionaryHint', function(editor) {
    var cur = editor.getCursor();
    var curLine = editor.getLine(cur.line);
    var start = cur.ch;
    var end = start;
    while (end < curLine.length && /[\w$]/.test(curLine.charAt(end))) ++end;
    while (start && /[\w$]/.test(curLine.charAt(start - 1))) --start;
    var curWord = start !== end && curLine.slice(start, end);
    var regex = new RegExp('^' + curWord, 'i');
    return {
        list: (!curWord ? [] : hintlist.filter(function(item) {
            return item.match(regex);
        })).sort(),
        from: CodeMirror.Pos(cur.line, start),
        to: CodeMirror.Pos(cur.line, end)
    }
});
 var editor = CodeMirror.fromTextArea(document.getElementById("dataText"), {
        lineNumbers: true,
        mode: "xml",
        autoCloseTags:true,
        matchClosing: true,
		indentWithTabs: true,
		matchTags:true,
		matchBrackets: true,
		showTrailingSpace:true,
		autoCloseBrackets:true,
		extraKeys:{"Ctrl-Space":"toMatchingTag","Ctrl-Alt-F": "findPersistent"},
        theme: 'monokai',
        value: document.documentElement.innerHTML
      });
	CodeMirror.commands.autocomplete = function (cm) {
    CodeMirror.showHint(cm, CodeMirror.hint.dictionaryHint);}
      window.onload = function() {
       settingsEnableAutocomplete(editor); 
       editor.setSize(null,616);

      };

function settingsEnableAutocomplete(editor) {
	console.log($('#autocompletesett').prop('checked'));
 	  CodeMirror.on(editor,"keyup", function(event,value) {
 	 if($('#autocompletesett').prop('checked') == true){
  		if(value.code != 'Backspace' && value.code != 'Delete' && value.code !='ArrowDown'  && value.code !='ArrowUp'  && value.code !='ArrowLeft'  && value.code !='ArrowRight' && value.ctrlKey!=true){
  			CodeMirror.showHint(editor, CodeMirror.hint.dictionaryHint)
  		}
  	else{
  		CodeMirror.off("keyup")

  	}
  }
  });
 }

</script>

	<!-- Js Libraries -->
	<script type="text/javascript" src="res/Js/bootstrap.min.js"></script>
	<script type="text/javascript" src="res/Js/mainFunctionality.js"></script>
	<script type="text/javascript" src="res/Js/shortcutHotkeys.js"></script>

</body>
</html>
